<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Exam Config Editor</title>
  <link rel="stylesheet" href="asset/stylesheet.css">
  <style>
    body { padding: 20px; max-width: 800px; margin: auto; font-family: Arial, sans-serif; }
    h1 { margin-bottom: 10px; }
    textarea { width: 100%; height: 300px; }
    .question-block { margin-bottom: 20px; padding: 12px; border: 1px solid #444; border-radius: 8px; }
    input, select { padding: 6px; margin: 4px 0; width: 100%; }
    button { margin-top: 10px; padding: 8px 12px; border-radius: 6px; border: 1px solid #444; background: #1f2937; color: #fff; cursor: pointer; }
    button.primary { background: #22c55e; border: none; }
  </style>
</head>
<body>
  <h1>Exam Configuration Editor</h1>
  <p>Edit exam title, duration, questions, and shuffle setting. Click <b>Save Config</b> to download a new <code>exam-config.json</code>.</p>

  <label>Exam Title:</label>
  <input type="text" id="examTitleInput">

  <label>Duration (minutes):</label>
  <input type="number" id="examTimeInput" min="1" value="30">

  <label>Shuffle Questions:</label>
  <select id="shuffleQuestionsSelect">
    <option value="true">Yes</option>
    <option value="false">No</option>
  </select>

  <div id="questionsContainer"></div>
  <button id="addQuestionBtn">+ Add Question</button>
  <br>
  <button id="saveBtn" class="primary">üíæ Save Config</button>

  <script>
    let questions = [];

    function renderQuestions() {
      const container = document.getElementById("questionsContainer");
      container.innerHTML = "";
      questions.forEach((q, idx) => {
        const block = document.createElement("div");
        block.className = "question-block";
        block.innerHTML = `
          <label>Question ${idx+1}:</label>
          <input type="text" value="${q.text}" oninput="questions[${idx}].text=this.value">

          <label>Options:</label>
          ${q.options.map((opt,i)=>`
            <input type="text" value="${opt}" oninput="questions[${idx}].options[${i}]=this.value">
          `).join("")}

          <label>Correct Answer:</label>
          <select onchange="questions[${idx}].answer=this.selectedIndex">
            ${q.options.map((opt,i)=>`
              <option value="${i}" ${q.answer===i?"selected":""}>
                ${String.fromCharCode(65+i)}: ${opt}
              </option>
            `).join("")}
          </select>

          <label>Marks:</label>
          <input type="number" value="${q.marks}" min="1" oninput="questions[${idx}].marks=parseInt(this.value)">

          <button onclick="removeQuestion(${idx})">‚ùå Remove</button>
        `;
        container.appendChild(block);
      });
    }

    function removeQuestion(i) {
      questions.splice(i,1);
      renderQuestions();
    }

    document.getElementById("addQuestionBtn").onclick = () => {
      questions.push({
        text:"New question?",
        options:["Option A","Option B","Option C","Option D"],
        answer:0,
        marks:1
      });
      renderQuestions();
    };

    document.getElementById("saveBtn").onclick = () => {
      const config = {
        title: document.getElementById("examTitleInput").value || "Exam",
        timeMinutes: parseInt(document.getElementById("examTimeInput").value),
        shuffleQuestions: document.getElementById("shuffleQuestionsSelect").value === "true",
        questions
      };
      const blob = new Blob([JSON.stringify(config, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "exam-config.json";
      a.click();
    };

    // Load current config if available
    fetch("exam-config.json")
      .then(r=>r.json())
      .then(cfg=>{
        document.getElementById("examTitleInput").value = cfg.title;
        document.getElementById("examTimeInput").value = cfg.timeMinutes;
        document.getElementById("shuffleQuestionsSelect").value = cfg.shuffleQuestions ? "true" : "false";
        questions = cfg.questions;
        renderQuestions();
      })
      .catch(err=>{
        console.log("No existing config found, starting new.");
      });
  </script>
</body>
</html>
